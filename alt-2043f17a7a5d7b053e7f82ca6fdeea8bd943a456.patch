From 2043f17a7a5d7b053e7f82ca6fdeea8bd943a456 Mon Sep 17 00:00:00 2001
From: Mikhail Efremov <sem@altlinux.org>
Date: Tue, 15 May 2012 16:41:09 +0400
Subject: [PATCH] Don't try to use internel documentation.

Based on patch from
https://bugzilla.xfce.org/show_bug.cgi?id=8846.
---
 xfce4-power-manager/Makefile.am                    |    6 +-----
 xfce4-power-manager/common/xfpm-common.c           |    6 ------
 xfce4-power-manager/common/xfpm-common.h           |    2 --
 xfce4-power-manager/configure.ac.in                |    4 ----
 .../data/interfaces/xfpm-settings.ui               |    2 +-
 xfce4-power-manager/settings/xfpm-settings.c       |    2 +-
 xfce4-power-manager/src/xfpm-power.c               |    8 +++++++-
 7 files changed, 10 insertions(+), 20 deletions(-)

diff --git a/xfce4-power-manager/Makefile.am b/xfce4-power-manager/Makefile.am
index 1c42d91..96a6738 100644
--- a/xfce4-power-manager/Makefile.am
+++ b/xfce4-power-manager/Makefile.am
@@ -11,8 +11,7 @@ SUBDIRS =        	\
 	src		\
 	settings	\
 	$(plugins_dir)	\
-	po           	\
-	doc
+	po
 
 
 EXTRA_DIST = 			\
@@ -41,9 +40,6 @@ dist-hook: ChangeLog
 distclean-local:
 	rm -rf *.cache
 
-html: Makefile
-	make -C doc html
-
 dist-bz2: dist
 	zcat $(PACKAGE)-$(VERSION).tar.gz | \
 	bzip2 --best -c > $(PACKAGE)-$(VERSION).tar.bz2
diff --git a/xfce4-power-manager/common/xfpm-common.c b/xfce4-power-manager/common/xfpm-common.c
index eca2ed5..914b5cc 100644
--- a/xfce4-power-manager/common/xfpm-common.c
+++ b/xfce4-power-manager/common/xfpm-common.c
@@ -112,12 +112,6 @@ xfpm_preferences (void)
     g_spawn_command_line_async ("xfce4-power-manager-settings", NULL);
 }
 
-void       
-xfpm_help (void)
-{
-    g_spawn_command_line_async ("xfhelp4 xfce4-power-manager.html", NULL);
-}
-
 void
 xfpm_quit (void)
 {
diff --git a/xfce4-power-manager/common/xfpm-common.h b/xfce4-power-manager/common/xfpm-common.h
index 2dce854..d5b181e 100644
--- a/xfce4-power-manager/common/xfpm-common.h
+++ b/xfce4-power-manager/common/xfpm-common.h
@@ -44,8 +44,6 @@ void       	xfpm_lock_screen  		(void);
 
 void       	xfpm_preferences		(void);
 
-void       	xfpm_help			(void);
-
 void            xfpm_quit                       (void);
 
 void       	xfpm_about			(GtkWidget *widget, 
diff --git a/xfce4-power-manager/configure.ac.in b/xfce4-power-manager/configure.ac.in
index 17d4e21..2e31ea1 100644
--- a/xfce4-power-manager/configure.ac
+++ b/xfce4-power-manager/configure.ac
@@ -235,10 +235,6 @@ data/icons/scalable/Makefile
 data/icons/scalable/status/Makefile
 data/icons/scalable/actions/Makefile
 data/interfaces/Makefile
-doc/Makefile
-doc/C/Makefile
-doc/C/xfce4-power-manager.xml
-doc/C/images/Makefile
 po/Makefile.in
 ])
 
diff --git a/xfce4-power-manager/data/interfaces/xfpm-settings.ui b/xfce4-power-manager/data/interfaces/xfpm-settings.ui
index 98f8710..b3dbee3 100644
--- a/xfce4-power-manager/data/interfaces/xfpm-settings.ui
+++ b/xfce4-power-manager/data/interfaces/xfpm-settings.ui
@@ -1425,7 +1425,7 @@
       </object>
     </child>
     <action-widgets>
-      <action-widget response="0">help-button</action-widget>
+      <action-widget response="-11">help-button</action-widget>
       <action-widget response="0">close-button</action-widget>
     </action-widgets>
   </object>
diff --git a/xfce4-power-manager/settings/xfpm-settings.c b/xfce4-power-manager/settings/xfpm-settings.c
index 5275247..44bee89 100644
--- a/xfce4-power-manager/settings/xfpm-settings.c
+++ b/xfce4-power-manager/settings/xfpm-settings.c
@@ -1617,7 +1617,7 @@ static void dialog_response_cb (GtkDialog *dialog, gint response, XfconfChannel
     switch(response)
     {
 	case GTK_RESPONSE_HELP:
-	    xfpm_help();
+	    xfce_dialog_show_help (GTK_WINDOW (dialog), "xfce4-power-manager", "preferences", NULL);
 	    break;
 	default:
 	    settings_quit (GTK_WIDGET (dialog), channel);
diff --git a/xfce4-power-manager/src/xfpm-power.c b/xfce4-power-manager/src/xfpm-power.c
index e32c185..151bebc 100644
--- a/xfce4-power-manager/src/xfpm-power.c
+++ b/xfce4-power-manager/src/xfpm-power.c
@@ -472,6 +472,12 @@ xfpm_power_presentation_mode_cb (XfpmPower *power)
 }
 
 static void
+xfpm_power_help_cb (GtkMenuItem *menuitem, gpointer user_data)
+{
+    xfce_dialog_show_help (NULL, "xfce4-power-manager", NULL, NULL);
+}
+
+static void
 xfpm_power_show_tray_menu (XfpmPower *power, 
 			 GtkStatusIcon *icon, 
 			 guint button, 
@@ -587,7 +593,7 @@ xfpm_power_show_tray_menu (XfpmPower *power,
     mi = gtk_image_menu_item_new_from_stock (GTK_STOCK_HELP, NULL);
     gtk_widget_set_sensitive (mi, TRUE);
     gtk_widget_show (mi);
-    g_signal_connect (mi, "activate", G_CALLBACK (xfpm_help), NULL);
+    g_signal_connect (mi, "activate", G_CALLBACK (xfpm_power_help_cb), NULL);
 	
     gtk_menu_shell_append (GTK_MENU_SHELL (menu), mi);
     
-- 
1.7.3.3

